<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The GNU Health Control Center &mdash; GNU Health Hospital Management 4.2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=0cd558ae"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js?v=ffc8af2d"></script>
        <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js?v=12818e64"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The SYSINFO Command" href="sysinfo.html" />
    <link rel="prev" title="Central Authentication" href="centralauthentication.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            GNU Health Hospital Management
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../preface.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support.html">Resources and Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functionality.html">GNU Health HMIS functionality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics/index.html">The Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patientmanagement/index.html">Patient Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../healthcentermanagement/index.html">Health Center Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gnuhealthfederation/index.html">GNU Health Federation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modulesindetail/index.html">Modules in Detail</a></li>
<li class="toctree-l1"><a class="reference internal" href="../his/index.html">Health Information System</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">GNU Health HMIS Node Technical Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation/index.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="administration/index.html">Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="centralauthentication.html">Central Authentication</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The GNU Health Control Center</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#about-the-gnu-health-control-center">About the GNU Health Control Center</a></li>
<li class="toctree-l3"><a class="reference internal" href="#invoking-gnuhealth-control">Invoking gnuhealth-control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#backups">Backups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updating-gnu-health-with-gnuhealth-control">Updating GNU Health with gnuhealth-control</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#checking-for-new-updates">Checking for new updates</a></li>
<li class="toctree-l4"><a class="reference internal" href="#installing-the-updates">Installing the updates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#restore">Restore</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="sysinfo.html">The SYSINFO Command</a></li>
<li class="toctree-l2"><a class="reference internal" href="patches.html">Patches and Patchsets</a></li>
<li class="toctree-l2"><a class="reference internal" href="upgrade.html">Upgrade</a></li>
<li class="toctree-l2"><a class="reference internal" href="backups.html">Backups and High-Availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="restserver.html">FHIR REST server</a></li>
<li class="toctree-l2"><a class="reference internal" href="usingrestserver.html">Using the FHIR REST server</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../demo_test/index.html">Demo and test environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embedded/index.html">The GNU Health Embedded project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../techguide/index.html">GNU Health Federation Technical Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devcorner/devcorner.html">Developer’s Corner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/index.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../todo.html">ToDo’s</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GNU Health Hospital Management</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">GNU Health HMIS Node Technical Guide</a></li>
      <li class="breadcrumb-item active">The GNU Health Control Center</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/hmis/controlcenter.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="the-gnu-health-control-center">
<span id="hmis-controlcenter-the-gnu-health-control-center"></span><h1>The GNU Health Control Center<a class="headerlink" href="#the-gnu-health-control-center" title="Link to this heading"></a></h1>
<section id="about-the-gnu-health-control-center">
<span id="hmis-controlcenter-the-gnu-health-control-center-about-the-gnu-health-control-center"></span><h2>About the GNU Health Control Center<a class="headerlink" href="#about-the-gnu-health-control-center" title="Link to this heading"></a></h2>
<p>The GNU Health Control Center <code class="code docutils literal notranslate"><span class="pre">gnuhealth-control</span></code> is the main tool for administrative tasks of the <a class="reference internal" href="../functionality.html#functionality-gnu-health-hmis-functionality"><span class="std std-ref">GNU Health environment</span></a>.</p>
<p>It can perform backups and updates of the instance, and it can be used non-interactively (e.g. as a cron job). We recommend using gnuhealth-control to perform the administrative tasks, since it also creates a log file that will be very useful in case of problems.</p>
</section>
<section id="invoking-gnuhealth-control">
<span id="hmis-controlcenter-the-gnu-health-control-center-invoking-gnuhealth-control"></span><h2>Invoking gnuhealth-control<a class="headerlink" href="#invoking-gnuhealth-control" title="Link to this heading"></a></h2>
<p>The GNU Health Control Center resides in the UTIL directory of your server.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="n">usage</span><span class="p">:</span> <span class="n">gnuhealth</span><span class="o">-</span><span class="n">control</span> <span class="n">command</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="n">Command</span><span class="p">:</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>  <span class="n">version</span> <span class="p">:</span> <span class="n">Show</span> <span class="n">version</span>
<span class="linenos"> 6</span>  <span class="n">backup</span>  <span class="p">:</span> <span class="n">Backup</span> <span class="n">the</span> <span class="n">gnuhealth</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">attach</span> <span class="nb">dir</span> <span class="ow">and</span> <span class="n">database</span>
<span class="linenos"> 7</span>  <span class="n">update</span>  <span class="p">:</span> <span class="n">Download</span> <span class="ow">and</span> <span class="n">install</span> <span class="n">the</span> <span class="n">patches</span>
<span class="linenos"> 8</span>  <span class="n">getlang</span> <span class="p">:</span> <span class="n">Get</span> <span class="ow">and</span> <span class="n">install</span> <span class="o">/</span> <span class="n">update</span> <span class="n">the</span> <span class="n">language</span> <span class="n">pack</span> <span class="n">code</span>
<span class="linenos"> 9</span>  <span class="n">status</span>  <span class="p">:</span> <span class="n">Show</span> <span class="n">environment</span> <span class="ow">and</span> <span class="n">GNU</span> <span class="n">Health</span> <span class="n">HMIS</span> <span class="n">server</span> <span class="n">status</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="n">Options</span><span class="p">:</span>
<span class="linenos">12</span>
<span class="linenos">13</span>  <span class="o">--</span><span class="n">backdir</span>  <span class="p">:</span> <span class="n">destination</span> <span class="n">directory</span> <span class="k">for</span> <span class="n">the</span> <span class="n">backup</span> <span class="n">file</span>
<span class="linenos">14</span>  <span class="o">--</span><span class="n">dry</span><span class="o">-</span><span class="n">run</span>  <span class="p">:</span> <span class="n">Check</span><span class="p">,</span> <span class="n">download</span> <span class="ow">and</span> <span class="n">preview</span><span class="p">,</span> <span class="n">but</span> <span class="n">don</span><span class="s1">&#39;t actually run the update process</span>
<span class="linenos">15</span>  <span class="o">--</span><span class="n">database</span> <span class="p">:</span> <span class="n">database</span> <span class="n">name</span> <span class="n">to</span> <span class="n">use</span> <span class="k">with</span> <span class="n">the</span> <span class="n">backup</span> <span class="n">command</span>
</pre></div>
</div>
</section>
<section id="backups">
<span id="hmis-controlcenter-the-gnu-health-control-center-backups"></span><h2>Backups<a class="headerlink" href="#backups" title="Link to this heading"></a></h2>
<p>When using gnuhealth-control to perform backups, the application does the following tasks :</p>
<ul class="simple">
<li><p>Perform a backup of the database.</p></li>
<li><p>Perform a backup of the $HOME directory of the gnuhealth user, so it stores the kernel, rc files, modules and attach directory.</p></li>
</ul>
<p>To perform a backup, you call the gnuhealth-control utility with the database name and target directory where you want to store it.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>./gnuhealth-control<span class="w"> </span>backup<span class="w"> </span>--backdir<span class="w"> </span>&lt;directory&gt;<span class="w"> </span>--database<span class="w"> </span>&lt;dbname&gt;
</pre></div>
</div>
<p>GNU Health control backup command creates two files on your destination backup directory :</p>
<ul class="simple">
<li><p>The compressed database dump: The format is : <code class="code docutils literal notranslate"><span class="pre">backup_db-name_timestamp.gz</span></code></p></li>
<li><p>The database and filesystems for GNU Health.</p></li>
</ul>
</section>
<section id="updating-gnu-health-with-gnuhealth-control">
<span id="hmis-controlcenter-the-gnu-health-control-center-updating-gnu-health-with-gnuhealth-control"></span><h2>Updating GNU Health with gnuhealth-control<a class="headerlink" href="#updating-gnu-health-with-gnuhealth-control" title="Link to this heading"></a></h2>
<p>When gnuhealth-control is invoked with the update command, it will update GNU Health components within the same major number
The following components will be checked and updated if necessary:</p>
<ul class="simple">
<li><p>Trytond: Tryton server version</p></li>
<li><p>Standard Tryton modules included the official GNU Health installation</p></li>
<li><p>Security Advisories to be applied on the default Tryton kernel</p></li>
<li><p>GNU Health patchsets (see <a class="reference internal" href="patches.html#hmis-patches-patches-and-patchsets"><span class="std std-ref">Patches and Patchsets</span></a> for more information)</p></li>
</ul>
<p>This will be valid for version with the same major and minor numbers, for example 3.0.x will look for the latest Tryton updates and GNU Health updates associated to that release.</p>
<section id="checking-for-new-updates">
<span id="hmis-controlcenter-the-gnu-health-control-center-updating-gnu-health-with-gnuhealth-control-checking-for-new-updates"></span><h3>Checking for new updates<a class="headerlink" href="#checking-for-new-updates" title="Link to this heading"></a></h3>
<p>You can check the status on your Tryton and GNU Health server by running a dry-run update. Invoking the update command with the option <code class="code docutils literal notranslate"><span class="pre">--dry-run</span> <span class="pre">will</span></code> only check if your server needs to be updated, without doing any changes.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>./gnuhealth-control<span class="w"> </span>update<span class="w"> </span>--dry-run
</pre></div>
</div>
</section>
<section id="installing-the-updates">
<span id="hmis-controlcenter-the-gnu-health-control-center-updating-gnu-health-with-gnuhealth-control-installing-the-updates"></span><h3>Installing the updates<a class="headerlink" href="#installing-the-updates" title="Link to this heading"></a></h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Stop your GNU Health instance and do a full backup before starting the update}}</p>
</div>
<p><strong>The main steps are</strong>
#. Stop the instance and make a backup
#. Run the kernel update with gnuhealth-control tool
#. Update the database</p>
<p>Once you have stopped your instance, and made a full offline backup, you are ready to perform the actual update.</p>
<p>With the <strong>gnuhealth user</strong>, execute the following command. It will download all the Tryton and GNU Health patches, and it will reload the bash environment variables right after it.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>cdutil
<span class="linenos">2</span>./gnuhealth-control<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">source</span><span class="w"> </span><span class="nv">$HOME</span>/.gnuhealthrc
</pre></div>
</div>
<p>Finally, update your database</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>cdexe
<span class="linenos">2</span>./trytond-admin<span class="w"> </span>--all<span class="w"> </span>--database<span class="o">=</span>name_of_your_db
</pre></div>
</div>
<p>If everything went well, you have updated to the latest Tryton and GNU Health patchset !
You can now restart the server.</p>
<p>You can get the latest version of GNU Health control center at GNU <a class="reference external" href="ftp://ftp.gnu.org/gnu/health">ftp://ftp.gnu.org/gnu/health</a></p>
</section>
</section>
<section id="restore">
<span id="hmis-controlcenter-the-gnu-health-control-center-restore"></span><h2>Restore<a class="headerlink" href="#restore" title="Link to this heading"></a></h2>
<p>GNU Health control center allows you to restore a complete GNU Health instance, including the database and the filesystem. Of course, in order to perform a restore, you need to have a backup. I will concentrate on the backup done with the GNU Health control center.</p>
<p>To restore a database, connect with “gnuhealth” operating system user, and change to the directory where the database backup resides.</p>
<ol class="arabic simple">
<li><p><strong>Create a new database</strong></p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$<span class="w"> </span>createdb<span class="w"> </span>your_db_name
</pre></div>
</div>
<ol class="arabic simple">
<li><p><strong>Uncompress the database dump that was generated using GNU Health control</strong></p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$<span class="w"> </span>gunzip<span class="w"> </span>backup_db-name_timestamp.gz
</pre></div>
</div>
<ol class="arabic simple">
<li><p><strong>Restore the DB using psql</strong></p></li>
</ol>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span>$<span class="w"> </span>psql<span class="w"> </span>your_db_name<span class="w"> </span>&lt;<span class="w"> </span>backup_db-name_timestamp
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="centralauthentication.html" class="btn btn-neutral float-left" title="Central Authentication" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="sysinfo.html" class="btn btn-neutral float-right" title="The SYSINFO Command" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, GNU Solidario.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>